SET DEFINE OFF;
CREATE OR REPLACE TRIGGER TRG_CRBTXREQ_BEFORE 
 BEFORE
  INSERT
 ON crbtxreq
REFERENCING NEW AS NEWVAL OLD AS OLD
 FOR EACH ROW
DECLARE
    V_AUTOID NUMBER(30);
BEGIN
    SELECT TO_NUMBER(TO_CHAR(SYSDATE,'RRRRMMDD') || '999999' || :NEWVAL.REQID )
    INTO V_AUTOID
    FROM DUAL;
    :NEWVAL.REQID := V_AUTOID;

    IF :NEWVAL.BRANCH IS NULL THEN
      IF  NVL(INSTR(:NEWVAL.REQTXNUM,'FA'),0)>0  THEN
        :NEWVAL.BRANCH:='7906';
      ELSE
        :NEWVAL.BRANCH:='8146';
      END IF;
    END IF;

    IF :NEWVAL.OBJNAME = 'BLACKLIST' THEN
        :NEWVAL.STATUS:='C';
    END IF;
END;
/
