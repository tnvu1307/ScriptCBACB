SET DEFINE OFF;
CREATE OR REPLACE FUNCTION fn_check_rptid_custodycd(P_AUTOID NUMBER, P_RPTID VARCHAR2, P_CUSTODYCD VARCHAR2) RETURN VARCHAR2 IS
  V_COUNT NUMBER;
BEGIN

    IF NVL(P_AUTOID, 0) = 0 THEN
        SELECT COUNT(1) INTO V_COUNT FROM EMAILBONDAGENT WHERE RPTID = P_RPTID AND CUSTODYCD = P_CUSTODYCD;
    ELSE
        SELECT COUNT(1) INTO V_COUNT FROM EMAILBONDAGENT WHERE RPTID = P_RPTID AND CUSTODYCD = P_CUSTODYCD AND AUTOID <> P_AUTOID;
    END IF;

    IF V_COUNT > 0 THEN
        RETURN 'FALSE';
    ELSE
        RETURN 'TRUE';
    END IF;
END FN_CHECK_RPTID_CUSTODYCD;
/
