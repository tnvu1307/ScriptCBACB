SET DEFINE OFF;
CREATE OR REPLACE FUNCTION fn_get_balance_3386 (P_CAMASTID VARCHAR2, P_QTTY NUMBER) RETURN NUMBER
IS
    V_BALANCE NUMBER;
    V_RIGHTOFFRATE VARCHAR(50);
    L_LEFT_RIGHTOFFRATE VARCHAR2(30);
    L_RIGHT_RIGHTOFFRATE VARCHAR2(30);
    V_ROUNDMETHOD number;
BEGIN
    SELECT RIGHTOFFRATE, ROUNDMETHOD INTO V_RIGHTOFFRATE, V_ROUNDMETHOD FROM CAMAST WHERE CAMASTID = P_CAMASTID AND DELTD='N';

    SELECT SUBSTR(V_RIGHTOFFRATE,1,INSTR(V_RIGHTOFFRATE,'/')-1),
           SUBSTR(V_RIGHTOFFRATE,INSTR(V_RIGHTOFFRATE,'/') + 1,LENGTH(V_RIGHTOFFRATE))
    INTO L_LEFT_RIGHTOFFRATE, L_RIGHT_RIGHTOFFRATE
    FROM DUAL;

    V_BALANCE := FN_ROUND_AMTQTTY(P_QTTY*(L_LEFT_RIGHTOFFRATE/L_RIGHT_RIGHTOFFRATE), V_ROUNDMETHOD, 0);

    RETURN V_BALANCE;
EXCEPTION WHEN OTHERS THEN
       RETURN 0;
END;
/
