SET DEFINE OFF;
CREATE OR REPLACE FUNCTION fn_get_custodycd_fr_childfund(P_CUSTODYCD IN VARCHAR2)
    RETURN varchar2 IS
    V_RESULT varchar2(4000);
    V_MCUSTODYCD varchar2(50);
BEGIN
    V_RESULT:=P_CUSTODYCD;
    --Kiem tra xem co TK me hay khong?
    SELECT MCUSTODYCD INTO V_MCUSTODYCD FROM CFMAST WHERE CUSTODYCD=P_CUSTODYCD and status <> 'C';
    IF (V_MCUSTODYCD IS NOT NULL OR LENGTH(V_MCUSTODYCD) >3 ) THEN
        V_RESULT:=V_MCUSTODYCD;
    END IF;
RETURN TRIM(V_RESULT);
EXCEPTION
   WHEN OTHERS THEN
    RETURN P_CUSTODYCD;
END;
/
