SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('CA3356','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('CA3356', 'Chuyển chứng khoán thực hiện quyền thành giao dịch(GD 3356)', 'Change CA WFT stock to trade (3356)', 'SELECT MST.*,SE.QTTY, (SE.QTTY-REALQTTY) DIFFQTTY
FROM (
    SELECT MAX(MSTAUTOID) AUTOID,ISINCODE,CAMASTID ,MAX(DESCRIPTION) DESCRIPTION, MAX(TYPE) TYPE,MAX(TRADEDATE)TRADEDATE,MAX(PARVALUE) PARVALUE,
        MAX(PRICE) PRICE,SUM(TRADE) TRADE,SUM(BLOCKED) BLOCKED,MAX(CODEID) CODEID, MAX(SYMBOL) SYMBOL, MAX(CATYPE) CATYPE,
        SUM(CAQTTY) CAQTTY,SUM(REALQTTY) REALQTTY,MAX(CODEIDWFT) CODEIDWFT
    FROM (
        SELECT CAMAST.ISINCODE,CAMAST.AUTOID MSTAUTOID,CA.AUTOID,CAMAST.CAMASTID, CAMAST.DESCRIPTION, ''001'' TYPE,
            CAMAST.TRADEDATE ,SB.PARVALUE, SE.COSTPRICE PRICE , CF.CUSTODYCD,CF.CUSTID,
            AF.ACCTNO AFACCTNO,SB.CODEID, CF.FULLNAME,CF.IDCODE,CF.ADDRESS,SB.SYMBOL,SE.STATUS,
            AF.ACCTNO||SB.CODEID SEACCTNOCR,AF.ACCTNO||SBWFT.CODEID SEACCTNODR,
            LEAST(CA.QTTY,SE.TRADE) TRADE ,(CASE WHEN (CA.QTTY>SE.TRADE) THEN LEAST((CA.QTTY-SE.TRADE),SE.BLOCKED) ELSE 0 END) BLOCKED,A1.CDCONTENT CATYPE,
            CA.QTTY CAQTTY, (LEAST(CA.QTTY,SE.TRADE) + (CASE WHEN (CA.QTTY>SE.TRADE) THEN LEAST((CA.QTTY-SE.TRADE),SE.BLOCKED) ELSE 0 END)) REALQTTY,
            SBWFT.CODEID CODEIDWFT
        FROM VW_CAMAST_ALL CAMAST, VW_CASCHD_ALL CA, SEMAST SE, AFMAST AF, CFMAST CF, SBSECURITIES SB, SBSECURITIES SBWFT, SECURITIES_INFO SEINFO, ALLCODE A1
        WHERE CAMAST.CAMASTID = CA.CAMASTID
        AND CAMAST.ISWFT=''Y'' AND CA.ISSE=''Y''
        AND NVL(CAMAST.TOCODEID,CAMAST.CODEID) = SB.CODEID AND CA.AFACCTNO= SE.AFACCTNO
        AND SE.AFACCTNO = AF.ACCTNO AND AF.CUSTID = CF.CUSTID AND SB.CODEID = SEINFO.CODEID
        AND SE.CODEID = SBWFT.CODEID AND SBWFT.REFCODEID = SB.CODEID
        AND A1.CDVAL = CAMAST.CATYPE AND A1.CDNAME = ''CATYPE'' AND A1.CDTYPE = ''CA''
        AND SBWFT.TRADEPLACE = ''006'' AND CAMAST.STATUS IN (''H'',''J'')
        AND INSTR(NVL(CA.PSTATUS,''A''),''W'') <=0  
    )
    GROUP BY CAMASTID, ISINCODE
) MST,
(
    SELECT CODEID, SUM(SE2.TRADE+SE2.MORTAGE+SE2.STANDING+SE2.WITHDRAW+SE2.DEPOSIT+SE2.BLOCKED+SE2.SENDDEPOSIT+SE2.DTOCLOSE) QTTY
    FROM SEMAST SE2
    GROUP BY CODEID
) SE
WHERE MST.CODEIDWFT=SE.CODEID', 'SEMAST', 'frmSEMAST', 'AUTOID DESC', '3356', NULL, 5000, 'N', 1, 'NYNNYYYNNN', 'Y', 'T', '', 'N', '');COMMIT;