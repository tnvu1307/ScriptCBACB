SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('DD1000','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('DD1000', 'Quản lý phí', 'Management fee', 'SELECT * FROM (
    SELECT FEE.AUTOID,CF.FULLNAME,CF.CUSTODYCD,FEE.CIFID PROFOLIOCD,FEE.CURRENCY CCYCD ,FEE.FEEAMOUNT,FEE.FXRATE,FEE.FXAMOUNT,NVL(FEE.TAXAMOUNT,0) TAXAMOUNT,
            DECODE(FEE.CURRENCY,''VND'',ROUND((NVL(FEE.FEEAMOUNT,0) + NVL(FEE.TAXAMOUNT,0)),0),ROUND((NVL(FEE.FEEAMOUNT,0) + NVL(FEE.TAXAMOUNT,0)),2)) FEEAMTVAT,
            AL.<@CDCONTENT> STATUS,AL.CDVAL STATUSCDVAL,FEE.FEECODE,FEE.SETTLEDATE PAIDDATE,FEE.REMARK,TO_CHAR(FEE.TRANSDATE, ''DD/MM/RRRR'') TRANSDATE, TO_CHAR(FEE.SETTLEDATE, ''DD/MM/RRRR'') SETTLEDATE,
            FEE.TXDATE,FEE.FEETXDATE,FEE.FEETXNUM,FEE.BANKREFID,FEE.SPRACNO,
            TO_DATE(TO_CHAR(FEE.LASTCHANGE,''DD/MM/RRRR''),''DD/MM/RRRR'')LASTCHANGE,
            TO_CHAR(FEE.LASTCHANGE,''HH24:MI:SS'') CREATEDATE,A2.<@CDCONTENT> DELTD,A2.CDVAL DELTDCDVAL,FEE.FEENAME FEENAMECSTD,FEE.MCIFID,CF.MCUSTODYCD,
            AMC.SHORTNAME AMCSHORTNAME, GCB.SHORTNAME GCBSHORTNAME, 
            (CASE WHEN SETTLOG.CCYCD IS NOT NULL AND SETTLOG.CCYCD = FEE.CURRENCY THEN ''1.0000''
                  WHEN SETTLOG.CCYCD IS NOT NULL AND SETTLOG.CCYCD <> FEE.CURRENCY THEN TO_CHAR(SETTLOG.EXCHANGERATE, ''FM999,999,999,990.000099'')
                  ELSE ''N/A''
            END) EXCHANGERATE, NVL(SETTLOG.AITHERTXAMT, 0) AITHERTXAMT, NVL(SETTLOG.CCYCD, FEE.CURRENCY) EXCHANGECCYCD,
            (CASE WHEN FEE.STATUS IN (''P'',''C'',''X'') THEN '''' ELSE BANKACCOUNT END) BANKACCTNO
    FROM
    (
        SELECT * FROM FEE_BOOKING_RESULT
        UNION ALL
        SELECT * FROM FEE_BOOKING_RESULTHIST
    ) FEE,
    (
        SELECT * FROM CFMAST 
        WHERE SUPEBANK = ''N'' 
        --AND STATUS NOT IN (''C'')
    ) CF,
    (SELECT * FROM ALLCODE WHERE CDTYPE = ''DD'' AND CDNAME = ''FSTATUS'') AL,
    (SELECT * FROM ALLCODE WHERE CDTYPE = ''DD'' AND CDNAME = ''DELTDTEXT'') A2,
    (SELECT * FROM FAMEMBERS WHERE ROLES = ''AMC'') AMC,
    (SELECT * FROM FAMEMBERS WHERE ROLES = ''GCB'') GCB,
    (SELECT * FROM SETTLE_FEE_LOG) SETTLOG
    WHERE FEE.CIFID = CF.CIFID
    AND FEE.STATUS = AL.CDVAL(+)
    AND FEE.DELTD = A2.CDVAL(+)
    AND CF.AMCID = AMC.AUTOID(+)
    AND CF.GCBID = GCB.AUTOID(+)
    AND FEE.AUTOID = SETTLOG.FEEBOOKINGAUOID(+)
    AND (CASE WHEN FEE.STATUS = ''X'' THEN ''N'' ELSE NVL(FEE.DELTD,''N'') END) NOT IN (''Y'')
)
WHERE 0=0', 'DD1000', 'frmFEEBOOKING', 'LASTCHANGE desc,CREATEDATE desc', NULL, 0, 5000, 'N', 1, 'NNNNYYYNNN', 'Y', 'T', NULL, 'N', NULL);COMMIT;