SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('SHVSWIFTHIST','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('SHVSWIFTHIST', 'Lịch sử điện Swift nhận từ khách hàng', 'Management history of Swift messages from Client', 'SELECT S.MSGID REQUESTID,SDTLD.SETTLEDATE,SDTLD.TRADEDATE, MTTYPE,V.<@CDCONTENT> DESCS, CF.CUSTODYCD, SENDERBICCODE, S.CFNSTATUS, S.STATUS, A.<@CDCONTENT> CFNSTATUSTEXT,
TO_CHAR(S.CREATEDATE,''DD/MM/RRRR'') CREATEDATE, TO_CHAR(S.CREATEDATE,''HH24:MI:SS'') CREATETIME, CFNDESC NOTE, A1.<@CDCONTENT> STATUSTEXT, ERRORDESC, CF.CIFID, S.REFTXNUM,
S.CREATEDATE CREATEDATEORDER, SDTLD.C35B,A2.<@CDCONTENT> SI,TO_CHAR(S.EFFDATE,''DD/MM/RRRR'') EFFDATE,TO_CHAR(S.EXPDATE,''DD/MM/RRRR'') EXPDATE,S.NOTE NOTESI 
FROM SWIFTMSGMAPLOGHIST S, (SELECT *FROM CFMAST WHERE STATUS <> ''C'' ) CF,
    (SELECT * FROM SWIFTMSGMAPLOGDTLHIST WHERE DEFNAME IN (''FIAC.97A.SAFE'',''USECU.97A.SAFE'')) SDTL,
    (
        SELECT MSGID,
            MAX(CASE WHEN DEFNAME=''TRADDET.98A.SETT'' THEN DEFVALUE ELSE '''' END) SETTLEDATE,
            MAX(CASE WHEN DEFNAME=''TRADDET.98A.TRAD'' THEN DEFVALUE ELSE '''' END) TRADEDATE,
            MAX(CASE WHEN DEFNAME LIKE ''%35B%'' THEN REPLACE(DEFVALUE,''ISIN '','''') ELSE '''' END) C35B
        FROM SWIFTMSGMAPLOGDTLHIST
        WHERE DEFNAME IN (''TRADDET.98A.SETT'',''TRADDET.98A.TRAD'') OR DEFNAME LIKE ''%35B%''
        GROUP BY MSGID
    ) SDTLD,
    (SELECT * FROM ALLCODE WHERE CDNAME = ''SWIFT_STATUS'' AND CDTYPE = ''ST'') A,
    (SELECT * FROM ALLCODE WHERE CDNAME = ''RMSTATUS'' AND CDTYPE = ''CI'') A1,
    (SELECT * FROM ALLCODE WHERE CDNAME = ''YESNO'' AND CDTYPE = ''SY'') A2,
    (SELECT VSDMT, DESCRIPTION CDCONTENT, EN_DESCRIPTION EN_CDCONTENT FROM  VSDTRFCODE WHERE BANKCODE = ''CBP'' AND TYPE NOT IN (''REQ'')) V
WHERE S.CFNSTATUS = A.CDVAL AND S.MTTYPE=V.VSDMT(+) AND S.STATUS = A1.CDVAL
AND S.MSGID = SDTL.MSGID(+) AND  SDTL.DEFVALUE=CF.CIFID(+)
AND S.MSGID = SDTLD.MSGID(+)
AND NVL(S.SI,''N'') = A2.CDVAL (+)', 'SHVSWIFT', 'SHVSWIFT', ' CREATEDATE DESC, CREATETIME DESC', NULL, 0, 100, 'Y', 1, NULL, 'Y', 'T', NULL, 'N', NULL);COMMIT;