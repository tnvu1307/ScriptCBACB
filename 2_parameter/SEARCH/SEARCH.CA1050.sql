SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('CA1050','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('CA1050', 'Điều chỉnh màn hình master theo dõi nhắc việc CA', 'Adjust the master screen to monitor the CA prompt', 'SELECT * FROM (
SELECT
CASE WHEN CA.STATUS in (''H'',''J'') AND CA.TRADEDATE is null and CA.CATYPE in (''009'',''011'',''020'',''017'',''021'',''014'',''023'',''040'')  THEN ''FOLLOW UP FIRST TRADING DATE'' 
    WHEN LOG.APPROVE_DT = GETCURRDATE and CA.REPORTDATE >= GCD.GETCURRDATE and ca.status in (''N'') THEN ''CAPTURE DATE''
    WHEN (GETNEXTDATE2(CA.REPORTDATE,2) = GCD.GETCURRDATE OR GETNEXTDATE2(CA.REPORTDATE,1) = GCD.GETCURRDATE) and ca.status in (''N'',''A'') THEN ''RECORD DATE +1''
    WHEN GETPREVDATE(CA.ACTIONDATE, 1) = GCD.GETCURRDATE AND (CA.CATYPE IN (''010'',''011'',''021'',''014'',''020'',''017'',''023'',''015'',''016'',''027'',''024'',''033'',''040'')) THEN ''PAYMENT DATE -1''
    WHEN CA.ACTIONDATE = GCD.GETCURRDATE AND (CA.CATYPE IN (''010'',''015'',''016'',''027'',''024'',''033'')) THEN ''PAYMENT DATE''
    WHEN CA.ACTIONDATE = GCD.GETCURRDATE AND (CA.CATYPE IN (''011'',''021'',''014'',''020'',''017'',''023'',''040'')) THEN ''EXPECTED PAYMENT DATE (FOR SHARE EVENTS)''
    WHEN CA.RECEIVEDATE = GCD.GETCURRDATE AND (CA.CATYPE IN (''020'',''017'',''023'')) THEN ''EXPECTED PAYMENT DATE (FOR SHARE EVENTS)''
    WHEN CA.TRADEDATE = GCD.GETCURRDATE AND (CA.CATYPE IN (''011'',''021'',''014'',''020'',''017'',''023'')) THEN ''FIRST TRADING DATE''
    WHEN CA.INSDEADLINE = GCD.GETCURRDATE AND (CA.CATYPE IN (''014'',''023'')) THEN ''INSTRUCTION DEADLINE(FOR RIGHT SUBSCRIPTION, BOND CONVERSION)''
    WHEN GETPREVDATE(CA.DEBITDATE, 1) = GCD.GETCURRDATE AND (CA.CATYPE IN (''014'')) THEN ''DEBIT DATE -1''
    WHEN CA.DEBITDATE = GCD.GETCURRDATE AND (CA.CATYPE IN (''014'')) THEN ''DEBIT DATE''
    WHEN CA.ACTIONDATE = GCD.GETCURRDATE AND CA.CATYPE IN(''006'',''028'',''005'') THEN ''MEETING/PROCESSING DATE''
    WHEN TO_DATE(NVL(CA.INSTRUCTION, ''01/01/2020''),''DD/MM/RRRR'') = GCD.GETCURRDATE AND CA.CATYPE IN(''006'',''028'',''005'') THEN ''INSTRUCTION DEADLINE(FOR PROXY EVENT)''
    WHEN TO_DATE(NVL(CA.INSTRUCTION, ''01/01/2020''),''DD/MM/RRRR'') = GETNEXTDATE2(GETCURRDATE, 5) AND CA.CATYPE IN(''006'',''028'',''005'') THEN ''INSTRUCTION DEADLINE - 5''
    WHEN TO_DATE(NVL(CA.INSTRUCTION, ''01/01/2020''),''DD/MM/RRRR'') = GETNEXTDATE2(GETCURRDATE, 2) AND CA.CATYPE IN(''006'',''028'',''005'') THEN ''INSTRUCTION DEADLINE - 2''
    WHEN CA.INSDEADLINE = GETNEXTDATE2(GCD.GETCURRDATE, 5) AND CA.CATYPE IN(''014'',''023'') THEN ''INSTRUCTION DEADLINE - 5''
    WHEN CA.INSDEADLINE = GETNEXTDATE2(GCD.GETCURRDATE, 2) AND CA.CATYPE IN(''014'',''023'') THEN ''INSTRUCTION DEADLINE - 2''
    ELSE '''' END ALERTTYPE,
CA.CAMASTID CAMASTID, SB.SYMBOL SYMBOL, 
TO_CHAR(CA.REPORTDATE,''DD/MM/RRRR'') REPORTDATE,TO_CHAR(CA.ACTIONDATE,''DD/MM/RRRR'') ACTIONDATE, 
(CASE WHEN CA.CATYPE <> ''023'' THEN TO_CHAR(CA.DEBITDATE,''DD/MM/RRRR'') ELSE '''' END) DEBITDATE,
(CASE WHEN CA.CATYPE IN (''005'',''006'',''028'') THEN '''' ELSE TO_CHAR(CA.TRADEDATE,''DD/MM/RRRR'') END) TRADEDATE, --TRADE DATE
CA.DESCRIPTION DESCRIPTION,
(CASE WHEN CA.CATYPE IN (''017'') THEN NVL(TO_CHAR(CA.CONVERTDATE,''DD/MM/RRRR''),'''')
      WHEN CA.CATYPE IN (''023'') THEN NVL(TO_CHAR(CA.DEBITDATE,''DD/MM/RRRR''),'''') ELSE '''' END) INACTIONDATE,
TO_CHAR(NVL(LOG.APPROVE_DT,''''),''DD/MM/RRRR'') CAPTUREDATE,
(CASE WHEN CA.RIGHTOFFRATE IS NOT NULL THEN CA.RIGHTOFFRATE
        ELSE (CASE WHEN CA.EXRATE IS NOT NULL THEN CA.EXRATE
        ELSE (CASE WHEN CA.DEVIDENTRATE IS NOT NULL AND CA.DEVIDENTRATE <> ''0'' THEN CA.DEVIDENTRATE
        ELSE (CASE WHEN SPLITRATE IS NOT NULL THEN CA.SPLITRATE
        ELSE (CASE WHEN CA.INTERESTRATE IS NOT NULL THEN INTERESTRATE
        ELSE (CASE WHEN DEVIDENTSHARES IS NOT NULL THEN DEVIDENTSHARES
        ELSE ''0'' END)END)END)END) END)END) RATE, A1.CDCONTENT CATYPE
FROM (select GETCURRDATE from dual) GCD,CAMAST CA
LEFT JOIN SBSECURITIES SB ON SB.CODEID = CA.CODEID
LEFT JOIN (SELECT MIN(APPROVE_DT) APPROVE_DT, RECORD_KEY FROM MAINTAIN_LOG WHERE TABLE_NAME =''CAMAST'' GROUP BY RECORD_KEY
)LOG  ON CA.CAMASTID=SUBSTR(LOG.RECORD_KEY,13,LENGTH(LOG.RECORD_KEY)-13)
LEFT JOIN ALLCODE A1 ON A1.CDVAL = CA.CATYPE AND A1.CDTYPE=''CA'' AND A1.CDNAME=''CATYPE''
WHERE CA.STATUS NOT IN (''I'',''P'',''R'',''C'',''D'') AND CA.DELTD <> ''Y''
) WHERE ALERTTYPE IS NOT NULL', 'CAMAST', 'frmCAMAST', '', '', NULL, 5000, 'N', 1, 'NYNNYYYNNN', 'Y', 'T', '', 'N', '');COMMIT;