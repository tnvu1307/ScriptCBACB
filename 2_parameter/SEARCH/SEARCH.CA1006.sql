SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('CA1006','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('CA1006', 'Danh sách cổ phiếu thưởng(đối chiếu)', 'List of bonus share event (compare)', 'SELECT DT.*,
(CASE WHEN DT.MODQTTY_TMP = 1 THEN DT.QTTY_TMP + 1 ELSE DT.QTTY_TMP END) QTTY,
(CASE WHEN DT.MODQTTY_TMP = 1 THEN 0 ELSE DT.MODQTTY_TMP * DT.EXPRICE END) AMT,
(CASE WHEN DT.MODQTTY_TMP = 1 OR DT.MODQTTY_TMP = 0 THEN ''0'' ELSE TO_CHAR(DT.MODQTTY_TMP, ''FM999,999,999,999,990.999999999'') END) MODQTTY
FROM
(
    SELECT DT.CUSTODYCD, DT.CAMASTID, DT.CIFID, DT.IDPLACE, DT.ADDRESS, DT.FULLNAME, DT.IDCODE, DT.IDDATE, DT.AUTOID, DT.AFACCTNO, DT.CODEID,
           DT.BALANCE, DT.TRADE, DT.REPORTDATE, DT.ACTIONDATE, DT.ISINCODE, DT.EXPRICE, DT.ROUNDMETHOD, DT.CIROUNDTYPE, DT.SYMBOL, DT.CATYPEVALUE,
           DT.CATYPE, DT.STATUS,
           TRUNC(DT.TRADE * DT.RATE) QTTY_TMP,
           FN_ROUND_AMTQTTY((DT.TRADE * DT.RATE) - TRUNC((DT.TRADE * DT.RATE)), DT.ROUNDMETHOD, DT.CIROUNDTYPE) MODQTTY_TMP
    FROM (
        SELECT MCF.CUSTODYCD, CAS.CAMASTID,
            MAX(MCF.CIFID) CIFID, MAX(MCF.IDPLACE) IDPLACE, MAX(MCF.ADDRESS) ADDRESS, MAX(MCF.FULLNAME) FULLNAME,
            DECODE(SUBSTR(MCF.CUSTODYCD,4,1), ''F'', MAX(CF.TRADINGCODE), MAX(MCF.IDCODE)) IDCODE,
            DECODE(SUBSTR(MCF.CUSTODYCD,4,1), ''F'', MAX(CF.TRADINGCODEDT), MAX(MCF.IDDATE)) IDDATE,
            MAX(CAS.AUTOID) AUTOID, MAX(CAS.AFACCTNO) AFACCTNO, MAX(CAS.CODEID) CODEID,
            SUM(CAS.BALANCE) BALANCE, SUM(CAS.TRADE) TRADE,
            MAX(CA.REPORTDATE) REPORTDATE, MAX(CA.ACTIONDATE) ACTIONDATE, MAX(CA.ISINCODE) ISINCODE, MAX(CA.EXPRICE) EXPRICE, MAX(CA.FRATE) RATE, MAX(CA.ROUNDMETHOD) ROUNDMETHOD, MAX(CA.CIROUNDTYPE) CIROUNDTYPE,
            MAX(SYM.SYMBOL) SYMBOL,
            MAX(A0.CDVAL) CATYPEVALUE, MAX(A0.<@CDCONTENT>) CATYPE, MAX(A1.<@CDCONTENT>) STATUS
        FROM CASCHD CAS, SBSECURITIES SYM, AFMAST AF, CFMAST CF, CFMAST MCF,
            (
                SELECT CA.*, TRUNC(TO_NUMBER(NVL(SUBSTR(EXRATE,INSTR(EXRATE,''/'') + 1,LENGTH(EXRATE)),''0'')) / TO_NUMBER(NVL(SUBSTR(EXRATE,0,INSTR(EXRATE,''/'') - 1),''1'')),50) FRATE
                FROM CAMAST CA
                WHERE CA.CATYPE = ''021''
                AND CA.DELTD = ''N''
            ) CA,
            (SELECT * FROM ALLCODE WHERE CDNAME = ''CATYPE'' AND CDTYPE = ''CA'') A0,
            (SELECT * FROM ALLCODE WHERE CDNAME = ''CASTATUS'' AND CDTYPE = ''CA'') A1
        WHERE CAS.CAMASTID = CA.CAMASTID
        AND CA.CODEID = SYM.CODEID
        AND CAS.AFACCTNO = AF.ACCTNO
        AND AF.CUSTID = CF.CUSTID
        AND NVL(CF.MCUSTODYCD, CF.CUSTODYCD) = MCF.CUSTODYCD
        AND CA.CATYPE = A0.CDVAL(+)
        AND CAS.STATUS = A1.CDVAL(+)
        AND CAS.DELTD =''N''
        GROUP BY MCF.CUSTODYCD, CAS.CAMASTID
    ) DT
) DT WHERE 0=0', 'CASCHD', 'frmCASCHD', '', '', NULL, 5000, 'N', 30, 'NYNNYYYNNY', 'Y', 'T', '', 'N', '');COMMIT;