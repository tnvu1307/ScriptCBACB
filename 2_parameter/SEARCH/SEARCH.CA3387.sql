SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('CA3387','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('CA3387', 'Thực cắt đăng ký quyền mua', 'Actual debit right issue register', 'SELECT DT.*, A1.<@CDCONTENT> STATUS, A2.<@CDCONTENT> CATYPE
FROM
(
    SELECT CAMAST.ISINCODE, SUBSTR(CAMAST.CAMASTID,1,4) || ''.'' || SUBSTR(CAMAST.CAMASTID,5,6) || ''.'' || SUBSTR(CAMAST.CAMASTID,11,6) CAMASTID,
           SYM_ORG.SYMBOL SYMBOL_ORG, SYM.SYMBOL, CAMAST.CATYPE CCATYPE, CAMAST.STATUS CSTATUS, SYM.PARVALUE,
           CAMAST.CODEID CODEID_ORG, CAMAST.TOCODEID CODEID, CAMAST.EXPRICE,
           SUM(CA.NMQTTY) NMQTTY, SUM(CA.BALANCE) BALANCE,
           SUM(CA.QTTY + CA.SENDQTTY + CA.CUTQTTY - CA.TQTTY) QTTY,
           SUM(CA.QTTY + CA.SENDQTTY + CA.CUTQTTY - CA.TQTTY - CA.NMQTTY) MQTTY,
           SUM(CA.QTTY + CA.SENDQTTY + CA.CUTQTTY - CA.TQTTY) * CAMAST.EXPRICE AMT
    FROM  SBSECURITIES SYM, CAMAST, CASCHD  CA, SBSECURITIES SYM_ORG,
    (
        SELECT CAMASTID, AFACCTNO, MSGSTATUS
        FROM CAREGISTER
        WHERE MSGSTATUS IN (''S'',''C'')
        GROUP BY CAMASTID,AFACCTNO,MSGSTATUS
    ) RIS
    WHERE CAMAST.TOCODEID = SYM.CODEID 
    AND CAMAST.CODEID = SYM_ORG.CODEID
    AND CAMAST.CAMASTID  = CA.CAMASTID
    AND CA.CAMASTID = RIS.CAMASTID
    AND CA.AFACCTNO = RIS.AFACCTNO
    AND CA.STATUS IN(''M'',''O'') 
    AND CA.STATUS <>''Y'' 
    AND CA.DELTD <> ''Y''
    AND CA.BALANCE > 0 
    AND (CA.QTTY + CA.SENDQTTY + CA.CUTQTTY - CA.TQTTY)  > 0
    AND CAMAST.CATYPE = ''014''   
    GROUP BY CAMAST.ISINCODE, CAMAST.CAMASTID, SYM_ORG.SYMBOL, SYM.SYMBOL, CAMAST.CATYPE, CAMAST.STATUS, SYM.PARVALUE, CAMAST.CODEID, CAMAST.TOCODEID, CAMAST.EXPRICE
) DT,
(
    SELECT * FROM ALLCODE WHERE CDNAME = ''CASTATUS'' AND CDTYPE = ''CA''
) A1,
(
    SELECT * FROM ALLCODE WHERE CDNAME = ''CATYPE'' AND CDTYPE = ''CA''
) A2
WHERE DT.CSTATUS = A1.CDVAL
AND DT.CCATYPE = A2.CDVAL', 'CAMAST', NULL, NULL, '3366', 0, 5000, 'N', 1, 'NYNNYYYNNN', 'Y', 'T', NULL, 'N', NULL);COMMIT;