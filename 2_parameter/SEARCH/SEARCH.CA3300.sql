SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('CA3300','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('CA3300', 'Đăng ký hủy bỏ quyền mua', 'Lapse purchasing rights', 'SELECT A.*,SB.SYMBOL SYMBOLRE
FROM
(
    SELECT CF.CUSTODYCD, CF.FULLNAME, CF.CIFID, CA.CAMASTID, SB.SYMBOL, CA.OPTSYMBOL CAMASTNAME, CA.RIGHTOFFRATE EXCERSISERATIO, CA.EXPRICE SUBSCRIPTIONPRICE, CA.TOCODEID, CA.CODEID CACODEID,
        (CAS.balance + CAS.pbalance + CAS.OUTBALANCE - CAS.INBALANCE) MAINBALANCE,
        (CAS.balance + CAS.pbalance + CAS.OUTBALANCE - CAS.INBALANCE) MAXBALANCE,
        (CAS.balance + CAS.pbalance + CAS.OUTBALANCE - CAS.INBALANCE) MAXCANBALANCE,
        (CAS.balance + CAS.pbalance + CAS.OUTBALANCE - CAS.INBALANCE - NVL(CAN.QTTY, 0)) REMAINCANBALANCE,
        CAS.INBALANCE, CAS.PBALANCE - CAS.QTTYCANCEL PBALANCE,
        CAS.BALANCE + CAS.OUTBALANCE BALANCE,
        NVL(CAN.QTTY, 0) CANBALANCE
    FROM CAMAST CA,CASCHD CAS,CFMAST CF, SBSECURITIES SB,AFMAST AF,
    (
        SELECT CAMASTID, CUSTODYCD, SUM(QTTY) QTTY FROM CACANCEL GROUP BY CAMASTID,CUSTODYCD
    ) CAN
    WHERE   CA.CATYPE = ''014''
        AND GETCURRDATE <= CA.DEBITDATE
        AND CA.STATUS IN (''V'', ''M'',''S'',''I'', ''J'', ''C'')
        AND CA.TOCODEID = SB.CODEID
        AND CA.CAMASTID = CAS.CAMASTID
        AND CF.CUSTID = AF.CUSTID
        AND AF.ACCTNO = CAS.AFACCTNO
        AND CA.CAMASTID = CAN.CAMASTID(+)
        AND CF.CUSTODYCD = CAN.CUSTODYCD(+)
        
)A, SBSECURITIES SB
WHERE A.CACODEID = SB.CODEID', 'CAMAST', '', '', '3300', NULL, 5000, 'N', 1, 'NNNNYYYNNN', 'Y', 'T', '', 'N', '');COMMIT;