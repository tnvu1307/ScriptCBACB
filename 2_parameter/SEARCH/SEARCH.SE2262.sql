SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('SE2262','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('SE2262', 'Tra cứu thông tin chứng quyền', 'Look up warrant information', 'SELECT CQ.*, CU.CUSTODYCD, NVL(CU.BALANCE, 0) BALANCE, CU.FULLNAME, A.CDCONTENT CSTATUS, SB.BONDNAME, SY.HISTDATE,
    NVL(SE.CLOSEPRICE, 0) CLOSEPRICE, SB.PARVALUE, MTB.PRICEADD,
    (CQ.QTTY * NVL(SE.CLOSEPRICE, 0) + AMTADD) MBALANCE,
    (-(CQ.QTTY * NVL(SE.CLOSEPRICE, 0) + AMTADD) + NVL(CU.BALANCE, 0)) DIFBALANCE,
    (CASE WHEN SB.SECTYPE NOT IN (''011'',''015'') THEN TO_CHAR(SB.EXPDATE,''DD/MM/RRRR'') ELSE TO_CHAR(SB.MATURITYDATE,''DD/MM/RRRR'') END) EXPDATE,
    (CQ.QTTYADD - CQ.QTTY) QTTYADDREMAIN
FROM SECURITIES_INFO SE, TBL_2260 MTB, SBSECURITIES SB,
(
    SELECT GETCURRDATE HISTDATE FROM DUAL
) SY,
(
    SELECT TB.REFAUTOID, TB.SYMBOL, TB.STATUS, MIN(TB.TXDATE) TXDATE, SUM(QTTY) QTTY, SUM(QTTYADD) QTTYADD, SUM((QTTYADD - QTTY) * PRICEADD) AMTADD, MAX(AUTOID) MAUTOID
    FROM TBL_2260 TB
    WHERE TB.DELTD = ''N''
    AND NOT EXISTS (
        SELECT LOG.REFAUTOID FROM TBL_2260_LOG LOG WHERE LOG.STATUS = ''C'' AND LOG.REFAUTOID = TB.REFAUTOID
    )
    GROUP BY TB.REFAUTOID, TB.STATUS, TB.SYMBOL
) CQ,
(
    SELECT TB.REFAUTOID, TB.CUSTODYCD, CF.FULLNAME,
        SUM(CASE WHEN TB.TRANTYPE = ''C'' THEN TB.BALANCE ELSE -TB.BALANCE END) BALANCE
    FROM TBL_2261 TB, CFMAST CF
    WHERE TB.DELTD = ''N''
    AND TB.CUSTODYCD = CF.CUSTODYCD
    GROUP BY TB.REFAUTOID, TB.CUSTODYCD, CF.FULLNAME
) CU,
(SELECT * FROM ALLCODE WHERE CDNAME = ''SE2260'' AND CDTYPE = ''SE'') A
WHERE CQ.MAUTOID = MTB.AUTOID
AND CQ.SYMBOL = SB.SYMBOL
AND CQ.REFAUTOID = CU.REFAUTOID(+)
AND CQ.SYMBOL = SE.SYMBOL(+)
AND CQ.STATUS = A.CDVAL(+)', 'SE2269', 'frmSE2269', '', '', NULL, 5000, 'N', 1, 'NYNNYYYNNN', 'Y', 'T', '', 'N', '');COMMIT;