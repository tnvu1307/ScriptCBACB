SET DEFINE OFF;DELETE FROM SEARCH WHERE 1 = 1 AND NVL(SEARCHCODE,'NULL') = NVL('CA1005','NULL');Insert into SEARCH   (SEARCHCODE, SEARCHTITLE, EN_SEARCHTITLE, SEARCHCMDSQL, OBJNAME, FRMNAME, ORDERBYCMDSQL, TLTXCD, CNTRECORD, ROWPERPAGE, AUTOSEARCH, INTERVAL, AUTHCODE, ROWLIMIT, CMDTYPE, CONDDEFFLD, BANKINQ, BANKACCT) Values   ('CA1005', 'Chia cổ tức băng cổ phiếu (đối chiếu)', 'Share dividend (compare)', 'SELECT DT.*,
(CASE WHEN DT.MODQTTY_TMP = 1 THEN DT.QTTY_TMP + 1 ELSE DT.QTTY_TMP END) QTTY,
(CASE WHEN DT.MODQTTY_TMP = 1 THEN 0 ELSE DT.MODQTTY_TMP * DT.EXPRICE END) AMT,
(CASE WHEN DT.MODQTTY_TMP = 1 OR DT.MODQTTY_TMP = 0 THEN ''0'' ELSE TO_CHAR(DT.MODQTTY_TMP, ''FM999,999,999,999,990.999999999'') END) MODQTTY
FROM
(
    SELECT DT.*,
    TRUNC(DT.TRADE * DT.RATE) QTTY_TMP,
    FN_ROUND_AMTQTTY((DT.TRADE * DT.RATE) - TRUNC((DT.TRADE * DT.RATE)), DT.ROUNDMETHOD, DT.CIROUNDTYPE) MODQTTY_TMP
    FROM
    (
        SELECT MCF.CUSTODYCD, CAS.CAMASTID,
            MAX(MCF.CIFID) CIFID, MAX(MCF.IDPLACE) IDPLACE, MAX(MCF.ADDRESS) ADDRESS, MAX(MCF.FULLNAME) FULLNAME,
            DECODE(SUBSTR(MCF.CUSTODYCD,4,1), ''F'', MAX(CF.TRADINGCODE), MAX(MCF.IDCODE)) IDCODE,
            DECODE(SUBSTR(MCF.CUSTODYCD,4,1), ''F'', MAX(CF.TRADINGCODEDT), MAX(MCF.IDDATE)) IDDATE,
            MAX(CAS.AUTOID) AUTOID, MAX(CAS.AFACCTNO) AFACCTNO, MAX(CAS.CODEID) CODEID,
            SUM(CAS.BALANCE) BALANCE, SUM(CAS.TRADE) TRADE,
            MAX(CA.REPORTDATE) REPORTDATE, MAX(CA.ACTIONDATE) ACTIONDATE, MAX(CA.ISINCODE) ISINCODE, MAX(CA.EXPRICE) EXPRICE, MAX(CA.FRATE) RATE, MAX(CA.ROUNDMETHOD) ROUNDMETHOD, MAX(CA.CIROUNDTYPE) CIROUNDTYPE,
            MAX(SYM.SYMBOL) SYMBOL,
            MAX(A0.CDVAL) CATYPEVALUE, MAX(A0.<@CDCONTENT>) CATYPE, MAX(A1.<@CDCONTENT>) STATUS
        FROM CASCHD CAS, SBSECURITIES SYM, AFMAST AF, CFMAST CF, CFMAST MCF,
            (
                SELECT CA.*,
                TRUNC(TO_NUMBER(NVL(SUBSTR(DEVIDENTSHARES,INSTR(DEVIDENTSHARES,''/'') + 1,LENGTH(DEVIDENTSHARES)),''0'')) / TO_NUMBER(NVL(SUBSTR(DEVIDENTSHARES,0,INSTR(DEVIDENTSHARES,''/'') - 1),''1'')),10) FRATE
                FROM CAMAST CA
                WHERE CA.CATYPE = ''011''
                AND CA.DELTD = ''N''
            ) CA,
            (SELECT * FROM ALLCODE WHERE CDNAME = ''CATYPE'' AND CDTYPE = ''CA'') A0,
            (SELECT * FROM ALLCODE WHERE CDNAME = ''CASTATUS'' AND CDTYPE = ''CA'') A1
        WHERE CA.CATYPE = A0.CDVAL(+)
        AND CAS.STATUS = A1.CDVAL(+)
        AND CAS.CAMASTID = CA.CAMASTID
        AND CA.CODEID = SYM.CODEID
        AND CAS.AFACCTNO= AF.ACCTNO
        AND AF.CUSTID = CF.CUSTID
        AND NVL(CF.MCUSTODYCD, CF.CUSTODYCD) = MCF.CUSTODYCD
        AND CAS.DELTD =''N''
        GROUP BY MCF.CUSTODYCD, CAS.CAMASTID
    ) DT
) DT WHERE 0=0', 'CASCHD', 'frmCASCHD', '', '', NULL, 5000, 'N', 1, 'NYNNYYYNNY', 'Y', 'T', '', 'N', '');COMMIT;