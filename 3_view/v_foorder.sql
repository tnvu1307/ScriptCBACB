SET DEFINE OFF;
CREATE OR REPLACE FORCE VIEW V_FOORDER
(USERNAME, FOACCTNO, ORDERID, TRADEPLACE, AFACCTNO, 
 CUSTODYCD, ACTYPE, CODEID, SEACCTNO, CIACCTNO, 
 BRATIO, TIMETYPE, EXECTYPE, NORK, MATCHTYPE, 
 VIA, CLEARDAY, CLEARCD, ORSTATUS, PRICETYPE, 
 EDSTATUS, QUOTEPRICE, STOPPRICE, LIMITPRICE, ORDERQTTY, 
 REMAINQTTY, EXECQTTY, STANDQTTY, CANCELQTTY, ADJUSTQTTY, 
 REJECTQTTY, QUOTEQTTY, REJECTCD, CUSTID, EXPRICE, 
 EXQTTY, DELTD, OODSTATUS, FEEDBACKMSG)
AS 
(
SELECT NVL(FO.USERNAME,'ATD') USERNAME,SUBSTR(FO.ACCTNO,1,4) || '.' || SUBSTR(FO.ACCTNO,5,6) || '.' || SUBSTR(FO.ACCTNO,11,6) FOACCTNO, nvl(ORGACCTNO,'----------------') ORDERID,
A0.CDCONTENT TRADEPLACE,SUBSTR(AFACCTNO,1,4) || '.' || SUBSTR(AFACCTNO,5,6) AFACCTNO,
SUBSTR(CF.CUSTODYCD,1,3) || '.' || SUBSTR(CF.CUSTODYCD,4,1) || '.' || SUBSTR(CF.CUSTODYCD,5,6)  CUSTODYCD, FO.ACTYPE,SE.SYMBOL CODEID,
SUBSTR(AFACCTNO,1,4) || '.' || SUBSTR(AFACCTNO,5,6) || '.' || SUBSTR(FO.CODEID,1,6) SEACCTNO,
SUBSTR(AFACCTNO,1,4) || '.' || SUBSTR(AFACCTNO,5,6) CIACCTNO,FO.BRATIO, A1.CDCONTENT TIMETYPE, A2.CDCONTENT EXECTYPE, A3.CDCONTENT NORK, A4.CDCONTENT MATCHTYPE,
A5.CDCONTENT VIA, CLEARDAY, A6.CDCONTENT CLEARCD, to_char(A8.CDCONTENT) ORSTATUS, A7.CDCONTENT PRICETYPE, to_char(A10.CDCONTENT) EDSTATUS, FO.QUOTEPRICE*INF.TRADEUNIT QUOTEPRICE,
FO.LIMITPRICE STOPPRICE,(case when pricetype in ('SL','LO') then FO.QUOTEPRICE*INF.TRADEUNIT else 0 end) LIMITPRICE, FO.QUANTITY ORDERQTTY, FO.REMAINQTTY, FO.EXECQTTY, 0 STANDQTTY,
FO.CANCELQTTY, 0 ADJUSTQTTY, 0 REJECTQTTY, FO.QUOTEQTTY  QUOTEQTTY ,'' REJECTCD,'' CUSTID,0 EXPRICE,0 EXQTTY,A9.CDCONTENT DELTD,
to_char(A8.CDCONTENT) OODSTATUS,(CASE WHEN FO.STATUS IN ('A','P') THEN '--------' ELSE FO.FEEDBACKMSG END) FEEDBACKMSG
FROM FOMAST FO, AFMAST AF, CFMAST CF, ALLCODE A0,ALLCODE A1,ALLCODE A2,ALLCODE A3,
    ALLCODE A4,ALLCODE A5,ALLCODE A6,ALLCODE A7,ALLCODE A8,ALLCODE A9,ALLCODE A10,SBSECURITIES SE,SECURITIES_INFO INF
WHERE FO.DELTD<>'Y' AND FO.CANCELQTTY=0 AND  FO.REMAINQTTY>0
AND SE.CODEID = FO.CODEID AND SE.CODEID = INF.CODEID
AND A0.CDTYPE = 'OD' AND A0.CDNAME = 'TRADEPLACE' AND A0.CDVAL = SE.TRADEPLACE
AND A10.CDTYPE = 'OD' AND A10.CDNAME = 'EDSTATUS' AND A10.CDVAL = 'N'
AND A8.CDTYPE = 'FO' AND A8.CDNAME = 'STATUS' AND A8.CDVAL = FO.STATUS
AND A1.CDTYPE = 'OD' AND A1.CDNAME = 'TIMETYPE'  AND A1.CDVAL = TIMETYPE
AND A2.CDTYPE = 'OD' AND A2.CDNAME = 'EXECTYPE'  AND A2.CDVAL = EXECTYPE
AND A3.CDTYPE = 'OD' AND A3.CDNAME = 'NORK'  AND A3.CDVAL = NORK
AND A4.CDTYPE = 'OD' AND A4.CDNAME = 'MATCHTYPE'  AND A4.CDVAL = MATCHTYPE
AND A5.CDTYPE = 'OD' AND A5.CDNAME = 'VIA'  AND A5.CDVAL = FO.VIA
AND A6.CDTYPE = 'OD' AND A6.CDNAME = 'CLEARCD'  AND A6.CDVAL = CLEARCD
AND A7.CDTYPE = 'OD' AND A7.CDNAME = 'PRICETYPE'  AND A7.CDVAL = PRICETYPE
AND A9.CDTYPE = 'SY' AND A9.CDNAME = 'YESNO' AND A9.CDVAL= FO.DELTD
AND FO.AFACCTNO= AF.ACCTNO AND AF.CUSTID=CF.CUSTID
AND TIMETYPE<>'G' AND (NVL(FO.TXNUM,'0000000000')||NVL(FO.TXDATE,to_date('01/01/1990','DD/MM/YYYY')) NOT IN (SELECT TXNUM||TXDATE FROM TLLOG WHERE TXSTATUS <>'1' ))
)
/
