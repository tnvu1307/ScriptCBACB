SET DEFINE OFF;
CREATE OR REPLACE FORCE VIEW VW_CFMAST_VSTP
(CUSTID, CUSTODYCD, MCUSTODYCD, FULLNAME, ADDRESS, 
 DATEOFBIRTH, PROVINCE, EMAIL, IDPLACE, IDCODE, 
 IDDATE, ALTERNATEID, IDTYPE, CUSTTYPE, PHONE, 
 COUNTRY)
AS 
(
    SELECT C.CUSTID, C.CUSTODYCD, C.MCUSTODYCD, C.FULLNAME, C.ADDRESS, C.DATEOFBIRTH, C.PROVINCE, C.EMAIL, C.IDPLACE,
        (CASE WHEN SUBSTR(C.CUSTODYCD, 4, 1) = 'F' THEN C.TRADINGCODE ELSE C.IDCODE END) IDCODE,
        (CASE WHEN SUBSTR(C.CUSTODYCD, 4, 1) = 'F' THEN C.TRADINGCODEDT ELSE C.IDDATE END) IDDATE,
        'VISD/' || (CASE WHEN C.IDTYPE = '001' THEN 'IDNO'
             WHEN C.IDTYPE = '002' THEN 'CCPT'
             WHEN C.IDTYPE = '005' THEN 'CORP'
             WHEN C.IDTYPE = '009' AND C.CUSTTYPE = 'B' THEN 'FIIN'
             WHEN C.IDTYPE = '009' AND C.CUSTTYPE = 'I' THEN 'ARNU'
             ELSE 'OTHR' END) ALTERNATEID,
        C.IDTYPE, C.CUSTTYPE, C.MOBILESMS PHONE, A1.CDCONTENT COUNTRY
    FROM CFMAST C
    LEFT JOIN (
        SELECT *
        FROM ALLCODE A
        WHERE CDNAME = 'NATIONAL'
        AND A.EN_CDCONTENT IS NOT NULL
    ) A1 ON C.COUNTRY = A1.CDVAL(+)
    WHERE C.STATUS NOT IN ('C')
)
/
