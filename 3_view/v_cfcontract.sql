SET DEFINE OFF;
CREATE OR REPLACE FORCE VIEW V_CFCONTRACT
(CUSTID, LINKTYPE, AFACCTNO, MODCODE, SYMBOL, 
 ACCTNO, AVLBAL, AFTYPE, ACTYPE)
AS 
SELECT CF.CUSTID, '001' LINKTYPE, MST.AFACCTNO, 'CI' MODCODE, CCY.CCYNAME SYMBOL, substr(MST.ACCTNO,1,4) || '.' || substr(MST.ACCTNO,5,6) ACCTNO, MST.BALANCE AVLBAL,AF.AFTYPE AFTYPE, AF.ACTYPE
FROM CFMAST CF, AFMAST AF, DDMAST MST, SBCURRENCY CCY
WHERE CF.CUSTID=AF.CUSTID AND TRIM(AF.ACCTNO)=TRIM(MST.AFACCTNO) AND TRIM(MST.CCYCD)=TRIM(CCY.CCYCD)
UNION ALL
SELECT CF.CUSTID, CF.LINKTYPE, MST.AFACCTNO, 'CI' MODCODE, CCY.CCYNAME SYMBOL, substr(MST.ACCTNO,1,4) || '.' || substr(MST.ACCTNO,5,6) ACCTNO, MST.BALANCE AVLBAL,AF.AFTYPE AFTYPE, AF.ACTYPE
FROM CFLINK CF, AFMAST AF, DDMAST MST, SBCURRENCY CCY
WHERE TRIM(CF.ACCTNO)=TRIM(AF.ACCTNO) AND TRIM(AF.ACCTNO)=TRIM(MST.AFACCTNO) AND TRIM(MST.CCYCD)=TRIM(CCY.CCYCD)
UNION ALL
SELECT CF.CUSTID, '001' LINKTYPE, MST.AFACCTNO, 'SE' MODCODE, CCY.SYMBOL, substr(MST.ACCTNO,1,4) || '.' || substr(MST.ACCTNO,5,6) || '.' || substr(MST.ACCTNO,11,6) ACCTNO, MST.TRADE AVLBAL,AF.AFTYPE AFTYPE, AF.ACTYPE
FROM CFMAST CF, AFMAST AF, SEMAST MST, SBSECURITIES CCY
WHERE CF.CUSTID=AF.CUSTID AND TRIM(AF.ACCTNO)=TRIM(MST.AFACCTNO) AND TRIM(MST.CODEID)=TRIM(CCY.CODEID)
UNION ALL
SELECT CF.CUSTID, CF.LINKTYPE, MST.AFACCTNO, 'SE' MODCODE, CCY.SYMBOL, substr(MST.ACCTNO,1,4) || '.' || substr(MST.ACCTNO,5,6) || '.' || substr(MST.ACCTNO,11,6) ACCTNO, MST.TRADE AVLBAL,AF.AFTYPE AFTYPE, AF.ACTYPE
FROM CFLINK CF, AFMAST AF, SEMAST MST, SBSECURITIES CCY
WHERE TRIM(CF.ACCTNO)=TRIM(AF.ACCTNO) AND TRIM(AF.ACCTNO)=TRIM(MST.AFACCTNO) AND TRIM(MST.CODEID)=TRIM(CCY.CODEID)
/
