SET DEFINE OFF;
CREATE OR REPLACE FORCE VIEW VW_ODMAST_IMPORT
(CTCK, CUSTODYCD, EXECTYPE, SYMBOL, PRICE, 
 QTTY, AMT, FEE, TAX, STATUS, 
 TXDATE, SETLDATE, ORDERID, TIMECREATE, ODTYPE, 
 SOURCE, EXECTYPEVAL, ISPAYMENT)
AS 
select "CTCK","CUSTODYCD","EXECTYPE","SYMBOL","PRICE","QTTY","AMT","FEE","TAX","STATUS","TXDATE","SETLDATE","ORDERID","TIMECREATE","ODTYPE","SOURCE","EXECTYPEVAL","ISPAYMENT"from (
SELECT OD.ORDERID,FA.SHORTNAME CTCK,OD.CUSTODYCD,A1.CDCONTENT EXECTYPE ,
        OD.SYMBOL,(CASE WHEN OD.ODTYPE <> 'SWE'  THEN round(OD.orderprice,6) ELSE  OD.NAV END) PRICE,
        OD.EXECQTTY QTTY,OD.EXECAMT AMT,OD.FEEAMT FEE,OD.TAXAMT TAX,
        OD.ORSTATUS STATUS,
        OD.trade_date TXDATE,OD.CLEARDATE SETLDATE,to_char(OD.lastchange,'DD/MM/RRRR hh24:mi:ss')||'' TIMECREATE,OD.odtype,OD.SOURCE,OD.EXECTYPE EXECTYPEVAL,OD.ispayment
    FROM ODMAST OD, FAMEMBERS FA,ALLCODE A1
    WHERE   OD.MEMBER = FA.AUTOID (+)
        AND A1.CDNAME = 'EXECTYPE' AND A1.CDTYPE = 'OD' AND A1.CDVAL = OD.EXECTYPE
union all
SELECT OD.ORDERID,FA.SHORTNAME CTCK,OD.CUSTODYCD,A1.CDCONTENT EXECTYPE ,
        OD.SYMBOL,(CASE WHEN OD.ODTYPE <> 'SWE'  THEN round(OD.orderprice,6) ELSE  OD.NAV END) PRICE,
        OD.EXECQTTY QTTY,OD.EXECAMT AMT,OD.FEEAMT FEE,OD.TAXAMT TAX,
        OD.ORSTATUS STATUS,
        OD.trade_date TXDATE,OD.CLEARDATE SETLDATE,to_char(OD.lastchange,'DD/MM/RRRR hh24:mi:ss')||'' TIMECREATE,OD.odtype,OD.SOURCE,OD.EXECTYPE EXECTYPEVAL,OD.ispayment
    FROM ODMASTHIST OD, FAMEMBERS FA,ALLCODE A1
    WHERE   OD.MEMBER = FA.AUTOID (+)
        AND A1.CDNAME = 'EXECTYPE' AND A1.CDTYPE = 'OD' AND A1.CDVAL = OD.EXECTYPE
)
group by TXDATE,CTCK,STATUS,CUSTODYCD,EXECTYPE,SYMBOL,PRICE,QTTY,AMT,FEE,TAX,SETLDATE,TIMECREATE,ORDERID,ODTYPE,SOURCE,EXECTYPEVAL,ISPAYMENT
order by TXDATE desc
/
